Last updated: 2025-12-08

# Project Overview

## プロジェクト概要
- YM2151 FM音源の音色を、Windows上で直感的に編集できるターミナルベースのエディタです。
- マウスやキーボード操作で音色パラメータをリアルタイムに変更し、即座にそのサウンドをプレビューできます。
- 変更は自動で保存され、次回起動時に前回の状態から編集を再開できるため、スムーズな音色作成が可能です。

## 技術スタック
- フロントエンド: `ratatui` (バージョン0.28) を使用し、リッチなターミナルユーザーインターフェース (TUI) を構築しています。`crossterm` (バージョン0.28) がクロスプラットフォームのターミナル操作の基盤を提供します。
- 音楽・オーディオ: `ym2151-log-play-server` ライブラリを通じて、YM2151音源のリアルタイム音声フィードバックを実現しています。これにより、パラメータ変更時の音色の変化をすぐに確認できます。
- 開発ツール: Rustの標準ビルドツールである`Cargo`を用いてプロジェクトのビルドと依存関係管理を行っています。
- テスト: Rustの組み込みテストフレームワークを使用し、各モジュール（UI、ファイル操作、MIDI変換など）の機能が正しく動作することを確認しています。
- ビルドツール: `Cargo`が、Rustプロジェクトのコンパイルと実行を管理します。
- 言語機能: `Rust` (バージョン1.70以降) で記述されており、安全性とパフォーマンスに優れたアプリケーションを提供します。

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📖 README_generate_gm_templates.md
📄 _config.yml
📁 docs/
  📖 KEYBINDS.ja.md
📄 generate_gm_templates.rs
📁 generated-docs/
🌐 googled947dc864c270e07.html
📁 issue-notes/
  📖 100.md
  📖 101.md
  📖 102.md
  📖 103.md
  📖 104.md
  📖 105.md
  📖 106.md
  📖 107.md
  📖 108.md
  📖 109.md
  📖 110.md
  📖 111.md
  📖 112.md
  📖 113.md
  📖 114.md
  📖 115.md
  📖 116.md
  📖 130.md
  📖 134.md
  📖 136.md
  📖 138.md
  📖 139.md
  📖 141.md
  📖 144.md
  📖 146.md
  📖 147.md
  📖 148.md
  📖 149.md
  📖 150.md
  📖 151.md
  📖 155.md
  📖 156.md
  📖 95.md
  📖 96.md
  📖 97.md
  📖 99.md
📁 src/
  📄 app.rs
  📄 app_init.rs
  📄 audio.rs
  📄 config.rs
  📄 file_ops.rs
  📄 main.rs
  📄 midi_conversion.rs
  📄 models.rs
  📄 register.rs
  📁 tests/
    📄 app_tests.rs
    📄 file_ops_tests.rs
    📄 midi_conversion_tests.rs
    📄 mod.rs
    📄 register_tests.rs
    📄 ui_tests.rs
    📄 variation_selector_tests.rs
    📄 verbose_logging_tests.rs
  📄 ui.rs
  📄 variation_selector.rs
📁 tones/
  📁 general_midi/
    📊 000_AcousticGrand.json
    📊 tone_names.json
📄 ym2151-tone-editor.toml.example
```

## ファイル詳細説明
- **`.gitignore`**: Gitバージョン管理システムにおいて、リポジトリに含めないファイルやディレクトリを指定する設定ファイルです。
- **`Cargo.lock`**: Rustプロジェクトの依存関係の正確なバージョンを記録し、ビルドの一貫性を保証します。
- **`Cargo.toml`**: Rustプロジェクトのマニフェストファイル。プロジェクト名、バージョン、ライブラリの依存関係などを定義します。
- **`LICENSE`**: プロジェクトの利用条件や著作権情報を示すライセンスファイルです。
- **`README.ja.md`, `README.md`**: プロジェクトの概要、機能、使い方などを説明する主要なドキュメント（日本語版と英語版）です。
- **`README_generate_gm_templates.md`**: General MIDIテンプレート生成スクリプトに関する補足説明を記載しています。
- **`_config.yml`**: GitHub Pagesなどのサイト構築に関する設定ファイルです。
- **`docs/KEYBINDS.ja.md`**: アプリケーションのキーバインド（キー操作）に関する詳細な説明ドキュメントです。
- **`generate_gm_templates.rs`**: General MIDIの音色テンプレートを生成するためのRustスクリプトファイルです。
- **`generated-docs/`**: プロジェクトから自動生成されるドキュメントやレポートを格納するためのディレクトリです。
- **`googled947dc864c270e07.html`**: Googleサービスによるウェブサイトの所有権確認などに使用される検証ファイルです。
- **`issue-notes/`**: 開発中の課題や検討事項に関するメモを記録しているディレクトリです。
- **`src/app.rs`**: アプリケーションの主要なロジック、状態管理、ユーザーイベント処理を定義するモジュールです。
- **`src/app_init.rs`**: アプリケーションの初期設定と起動時に必要な処理を扱うモジュールです。
- **`src/audio.rs`**: YM2151音源へのコマンド送信や、リアルタイム音声フィードバックに関連するロジックを管理するモジュールです。
- **`src/config.rs`**: アプリケーションの動作設定（例: キーバインド）を読み込み、管理するモジュールです。
- **`src/file_ops.rs`**: 音色データの保存、読み込み、その他のファイルシステム操作を担当するモジュールです。
- **`src/main.rs`**: プログラムのエントリーポイント。アプリケーション全体の起動とメインループの開始を担います。
- **`src/midi_conversion.rs`**: MIDI関連のデータ変換ロジック、例えばMML（Music Macro Language）から標準MIDIファイルへの変換などを扱うモジュールです。
- **`src/models.rs`**: アプリケーション内で使用されるデータ構造（YM2151のパラメータ、音色データなど）を定義するモジュールです。
- **`src/register.rs`**: YM2151音源のレジスタ操作に関する具体的なロジックを扱うモジュールです。
- **`src/tests/`**: アプリケーションの各機能やモジュールが正しく動作するかを確認するためのテストコードを格納するディレクトリです。
- **`src/ui.rs`**: ターミナルユーザーインターフェース (TUI) の描画ロジック、要素の配置、表示更新などを定義するモジュールです。
- **`src/variation_selector.rs`**: 音色のバリエーション選択や管理に関連するロジックを扱うモジュールです。
- **`tones/general_midi/000_AcousticGrand.json`**: General MIDIの000番「アコースティックグランドピアノ」に相当するYM2151音色データの例です。
- **`tones/general_midi/tone_names.json`**: 音色名のリストを格納するJSONファイルです。
- **`ym2151-tone-editor.toml.example`**: アプリケーションの設定ファイル（TOML形式）のサンプルです。

## 関数詳細説明
提供された情報からは個別の関数の詳細な役割、引数、戻り値などを具体的に特定することはできませんが、プロジェクトは明確な役割を持つ複数のモジュール化された関数で構成されています。主な機能領域には以下が含まれます。
- **ユーザーインターフェース処理**: ユーザーからのキー入力やマウスイベントを検知し、アプリケーションの状態を更新する関数群。
- **UI描画**: 現在のアプリケーションの状態（音色パラメータ、カーソル位置など）に基づいてターミナル画面に表示内容を描画する関数群。
- **音色データ管理**: YM2151音色データの読み込み、保存、パラメータ変更ロジックを処理する関数群。
- **オーディオ制御**: 編集中の音色パラメータをリアルタイムでYM2151音源サーバーに送信し、音声フィードバックを生成する関数群。
- **設定管理**: アプリケーションの起動時設定やユーザー定義のキーバインド設定を読み込み、適用する関数群。

これらの関数は、互いに連携しながら、直感的で応答性の高い音色編集体験を提供しています。

## 関数呼び出し階層ツリー
```
提供された情報からは具体的な関数呼び出し階層ツリーを生成することはできませんでした。
しかし、アプリケーションの主要な処理フローは、以下のような論理的な階層で構成されていると推測されます。

- **アプリケーション起動・初期化**: `main`関数から始まり、`app_init`モジュールで初期設定が行われます。
  - アプリケーションの状態、設定、UI要素の初期化。
  - オーディオサーバーの準備（`audio`モジュール経由）。
- **メインイベントループ**: ユーザーからの入力や内部イベントを継続的に監視・処理します。
  - **イベント処理**: `crossterm`ライブラリを使用してキーボードやマウスイベントを検知。
    - イベントは`app`モジュールのロジックによって解釈され、アプリケーションの状態を更新。
  - **ビジネスロジック実行**: `app`、`register`、`file_ops`、`midi_conversion`、`variation_selector`などの各モジュール内の関数が、音色パラメータの変更、データ保存、MIDIデータ変換などの中核的な処理を実行。
    - リアルタイム音声フィードバックのため、`audio`モジュール内の関数を呼び出し、音色データをオーディオサーバーに送信。
  - **UI描画**: `ui`モジュール内の関数が、現在のアプリケーションの状態（音色パラメータ、カーソル、メッセージなど）をターミナルに描画。
- **アプリケーション終了**: `ESC`キーなどの終了コマンドを受け取ると、アプリケーションは現在の音色データを自動保存（`file_ops`モジュール）し、リソースを解放して終了します。

これらの処理は、Rustのモジュールシステムを活用して構造化されており、各機能が連携しながらスムーズな音色編集環境を提供しています。

---
Generated at: 2025-12-08 07:08:16 JST
