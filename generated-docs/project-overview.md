Last updated: 2025-11-18

# Project Overview

## プロジェクト概要
- YM2151 FM音源の音色パラメータを直感的に編集するためのアプリケーションです。
- Rust言語とTUI（テキストユーザーインターフェース）を用いて、コマンドライン上で動作するエディタを提供します。
- リアルタイムでの音声フィードバック機能を備え、YM2151の音色作成を効率的にサポートします。

## 技術スタック
- フロントエンド:
    - **ratatui 0.28**: 端末上でリッチなユーザーインターフェースを構築するためのRust製TUIフレームワーク。音色パラメータの表示やカーソル操作など、ユーザーとのインタラクションを司ります。
    - **crossterm 0.28**: 異なるオペレーティングシステム間で一貫したターミナル操作（キー入力、カーソル移動、画面クリアなど）を可能にするクロスプラットフォームライブラリ。`ratatui` のバックエンドとして使用されます。
- 音楽・オーディオ:
    - **ym2151-log-play-server (ライブラリ)**: YM2151音源の再生を管理するサーバー（Windows専用）との連携ライブラリ。音色エディタから送信されたパラメータをリアルタイムでYM2151音源に反映させ、音声フィードバックを提供します。自動でサーバーの起動・管理を行います。
- 開発ツール:
    - **Rust 1.70+**: プロジェクトの主要なプログラミング言語。高い安全性とパフォーマンスを特徴とし、TUIアプリケーションの開発に適しています。
    - **Cargo**: Rustの公式ビルドシステムおよびパッケージマネージャ。プロジェクトの依存関係の管理、ビルド、テスト、実行を効率的に行います。
- テスト: 特になし
- ビルドツール:
    - **Cargo**: Rustプロジェクトのビルドプロセス全体を管理します。
- 言語機能:
    - **Rust**: メモリ安全性、並行処理、高いパフォーマンスを実現するための言語機能（所有権システム、ライフタイム、パターンマッチングなど）を活用しています。
- 自動化・CI/CD: 特になし
- 開発標準: 特になし

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 NOTE_ON_VISUALIZATION.md
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 issue-notes/
  📖 10.md
  📖 11.md
  📖 14.md
  📖 16.md
  📖 18.md
  📖 20.md
  📖 21.md
  📖 22.md
  📖 23.md
  📖 24.md
  📖 30.md
  📖 32.md
  📖 34.md
  📖 36.md
  📖 38.md
  📖 40.md
  📖 41.md
  📖 42.md
  📖 45.md
  📖 47.md
📁 src/
  📄 app.rs
  📄 file_ops.rs
  📄 main.rs
  📄 models.rs
  📄 register.rs
  📄 ui.rs
```

## ファイル詳細説明
-   **`.gitignore`**: Gitバージョン管理システムが無視すべきファイルやディレクトリのパターンを定義します。
-   **`Cargo.lock`**: プロジェクトが依存するクレートの正確なバージョンとその依存関係ツリーを記録し、再現性のあるビルドを保証します。
-   **`Cargo.toml`**: Rustプロジェクトのマニフェストファイル。プロジェクト名、バージョン、依存関係、ビルド設定などを定義します。
-   **`LICENSE`**: プロジェクトのライセンス情報（著作権、利用条件など）を記述したファイルです。
-   **`NOTE_ON_VISUALIZATION.md`**: 可視化に関する開発メモや考察が記述されているMarkdownファイルです。
-   **`README.md`**: プロジェクトの概要、機能、セットアップ方法、使用方法などを記述した基本的なドキュメントファイルです。
-   **`_config.yml`**: おそらく静的サイトジェネレータ（Jekyllなど）の設定ファイルで、ドキュメント生成などに使用されます。
-   **`generated-docs/`**: 自動生成されたドキュメントやレポートを格納するためのディレクトリです。
-   **`issue-notes/`**: 開発中の課題、検討事項、バグ報告などに関する詳細なメモやドキュメントを格納するディレクトリです。各ファイルは個別のイシューに対応しています。
-   **`src/app.rs`**: アプリケーションのコアロジックを定義します。ユーザー入力に応じたアプリケーションの状態更新（カーソル移動、パラメータ値の増減、保存処理など）を管理します。
-   **`src/file_ops.rs`**: ファイルI/Oに関する操作を扱います。特に、編集中のYM2151音色データをJSON形式で保存・読み込みする機能を提供します。
-   **`src/main.rs`**: アプリケーションのエントリポイントです。プログラムの起動、初期設定、メインイベントループの管理、TUIの初期化と終了処理などを担当します。
-   **`src/models.rs`**: YM2151音色データの内部表現（構造体）や、各パラメータ（DT, MULなど）の定義、最大・最小値などのデータモデルを定義します。
-   **`src/register.rs`**: YM2151のレジスタマップに関連する定数やヘルパー関数を定義します。パラメータ値の範囲チェックやYM2151のハードウェア仕様に合わせた処理を提供します。
-   **`src/ui.rs`**: `ratatui` クレートを使用して、ターミナル上に表示されるユーザーインターフェースの描画ロジックを担当します。YM2151パラメータのグリッド表示やカーソルの描画などを行います。

## 関数詳細説明
ソースコードが直接提供されていないため、各関数の具体的なシグネチャは不明ですが、プロジェクトの機能から推測される主要な関数とその役割を説明します。

-   **`main()`**:
    -   **役割**: プログラムの実行を開始するエントリポイント。
    -   **機能**: ターミナルの初期化、`app` のメインループ実行、`ym2151-log-play-server` の準備、ターミナルの終了処理を行います。
-   **`App::new()`**:
    -   **役割**: アプリケーションの初期状態を構築します。
    -   **機能**: YM2151音色データ、カーソル位置、アプリケーションの状態などを初期化します。
-   **`App::run()`**:
    -   **役割**: アプリケーションのメインイベントループを実行します。
    -   **機能**: ユーザー入力（キーボード、マウス）を継続的に監視し、イベントに応じてアプリケーションの状態を更新し、UIを再描画します。
-   **`App::handle_event(event)`**:
    -   **役割**: ユーザーからのイベント（キー押下、マウス操作など）を処理します。
    -   **引数**: `event` (ユーザー入力イベントの列挙型)。
    -   **機能**: カーソル移動、パラメータ値の増減、アプリケーションの終了、音色データの保存などの操作をイベントの種類に応じて実行します。
-   **`App::update_parameter(direction)`**:
    -   **役割**: 現在カーソルが位置するパラメータの値を増減させます。
    -   **引数**: `direction` (増加または減少を示す列挙型)。
    -   **機能**: パラメータの有効な範囲内で値を調整し、更新された音色データをリアルタイムでYM2151サーバーに送信します。
-   **`App::move_cursor(direction)`**:
    -   **役割**: TUI上のカーソル位置を移動させます。
    -   **引数**: `direction` (上下左右を示す列挙型)。
    -   **機能**: パラメータグリッド内でカーソルを移動させ、境界条件を処理します。
-   **`ui::draw(frame, app)`**:
    -   **役割**: アプリケーションの現在の状態に基づいてUIを描画します。
    -   **引数**: `frame` (描画フレームオブジェクト), `app` (アプリケーションの状態オブジェクト)。
    -   **機能**: YM2151パラメータのテーブル、現在値、カーソルなどをターミナル上に描画します。
-   **`file_ops::save_tone_data(path, tone_data)`**:
    -   **役割**: 現在の音色データをJSONファイルに保存します。
    -   **引数**: `path` (保存先のファイルパス), `tone_data` (YM2151音色データ)。
    -   **戻り値**: 成功またはエラーを示す結果。
    -   **機能**: アプリケーション終了時などに、編集した音色データを永続化します。
-   **`file_ops::load_tone_data(path)`**:
    -   **役割**: 指定されたJSONファイルから音色データを読み込みます。
    -   **引数**: `path` (読み込むファイルのパス)。
    -   **戻り値**: 読み込まれた`tone_data`またはエラーを示す結果。
    -   **機能**: アプリケーション起動時に前回の編集状態を復元するために使用されます。
-   **`ym2151_log_play_server::ensure_server_ready()`**:
    -   **役割**: YM2151再生サーバーが利用可能であることを確認し、必要に応じて起動・インストールします。
    -   **機能**: サーバーのセットアップと準備を自動的に行い、リアルタイム音声フィードバックのための環境を整えます。
-   **`ym2151_log_play_server::send_json(json_data)`**:
    -   **役割**: YM2151の音色パラメータをJSON形式で再生サーバーに送信します。
    -   **引数**: `json_data` (YM2151音色パラメータを含むJSON文字列)。
    -   **機能**: パイプ通信を用いてサーバーにデータを送り、リアルタイムでの音声変更をトリガーします。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした。ソースコードが直接提供されていないため、詳細な呼び出し関係を特定することはできません。

---
Generated at: 2025-11-18 07:08:40 JST
