Last updated: 2025-11-25

# Project Overview

## プロジェクト概要
- YM2151（OPM）FM音源の音色を編集するための、Windows向けターミナルユーザーインターフェースアプリケーションです。
- 直感的なキーボード・マウス操作とリアルタイムの音声フィードバックを通じて、効率的な音色作成を支援します。
- Rustで開発されており、起動速度と操作時の応答性を重視したシンプルかつ高機能な音色エディタを目指しています。

## 技術スタック
- フロントエンド: **ratatui 0.28** (Rust製のターミナルUIフレームワークで、リッチなテキストベースのユーザーインターフェースを構築), **crossterm 0.28** (クロスプラットフォーム対応のターミナル操作ライブラリで、キーボード入力、マウス操作、画面描画などを制御)
- 音楽・オーディオ: **ym2151-log-play-server** (リアルタイム音声フィードバックを提供するWindows限定のサーバーライブラリ), **YM2151（OPM）FM音源** (エディタがターゲットとするヤマハ製のFM音源チップ)
- 開発ツール: **Cargo** (Rustプロジェクトのビルドシステムおよびパッケージマネージャ)
- テスト: **Rust標準テストフレームワーク** (`src/tests/`ディレクトリ内のテストコードで利用)
- ビルドツール: **Cargo** (Rustアプリケーションのコンパイル、依存関係管理、実行)
- 言語機能: **Rust 1.70 以降** (安全性、並行性、パフォーマンスに優れたシステムプログラミング言語)
- 自動化・CI/CD: (プロジェクト情報からは特定の技術スタックを特定できませんでした)
- 開発標準: (プロジェクト情報からは特定の技術スタックを特定できませんでした)

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📁 docs/
  📖 KEYBINDS.ja.md
📁 generated-docs/
📁 issue-notes/
  📖 100.md
  📖 101.md
  📖 102.md
  📖 103.md
  📖 104.md
  📖 105.md
  📖 106.md
  📖 107.md
  📖 108.md
  📖 109.md
  📖 110.md
  📖 111.md
  📖 112.md
  📖 113.md
  📖 114.md
  📖 115.md
  📖 95.md
  📖 96.md
  📖 97.md
  📖 99.md
📁 src/
  📄 app.rs
  📄 app_init.rs
  📄 audio.rs
  📄 config.rs
  📄 file_ops.rs
  📄 main.rs
  📄 midi_conversion.rs
  📄 models.rs
  📄 register.rs
  📁 tests/
    📄 app_tests.rs
    📄 file_ops_tests.rs
    📄 midi_conversion_tests.rs
    📄 mod.rs
    📄 register_tests.rs
    📄 ui_tests.rs
    📄 verbose_logging_tests.rs
  📄 ui.rs
📁 tones/
  📁 general_midi/
    📊 000_AcousticGrand.json
📄 ym2151-tone-editor.toml.example
```

## ファイル詳細説明
- **.gitignore**: Gitのバージョン管理システムで追跡しないファイルやディレクトリを指定します。
- **Cargo.lock**: プロジェクトのビルドに必要な依存クレートの正確なバージョンとハッシュを記録し、再現性のあるビルドを保証します。
- **Cargo.toml**: Rustプロジェクトのメタデータ（プロジェクト名、バージョン、著者など）と、依存関係、ビルド設定を定義するマニフェストファイルです。
- **LICENSE**: プロジェクトのライセンス情報（ソフトウェアの利用・配布条件）を記載しています。
- **README.ja.md**: プロジェクトの概要、機能、ビルド・実行方法などを日本語で説明する主要なドキュメントです。
- **README.md**: プロジェクトの概要、機能、ビルド・実行方法などを英語で説明する主要なドキュメントです。
- **_config.yml**: GitHub PagesのJekyll設定ファイルで、静的サイトの生成に関する設定を定義します。
- **docs/KEYBINDS.ja.md**: アプリケーションのキーバインド（操作方法）に関する詳細な日本語ドキュメントです。
- **generated-docs/**: 自動生成されたドキュメントを格納するためのディレクトリです。
- **issue-notes/**: 開発中に検討された課題、アイデア、決定事項などを個別のMarkdownファイルとして記録しています。
- **src/app.rs**: アプリケーションの主要な状態管理、メインループ、イベント処理ロジックをカプセル化しています。UIの更新やオーディオフィードバックのトリガーなどもここで行われます。
- **src/app_init.rs**: アプリケーション起動時の初期化処理（TUIの準備、オーディオサーバーの起動、設定の読み込みなど）を担います。
- **src/audio.rs**: YM2151音源へのレジスタ書き込みコマンドの送信、およびリアルタイム音声フィードバックサーバーとの通信ロジックを管理します。
- **src/config.rs**: アプリケーションの設定（例: キーバインドマッピング、起動オプション）を読み込み、管理するための構造体や関数を定義しています。
- **src/file_ops.rs**: 音色データのファイルへの保存（自動セーブ機能など）およびファイルからのロードに関する操作を処理します。
- **src/main.rs**: Rustアプリケーションのエントリーポイントであり、プログラムの実行フローを初期化し、メインのアプリケーションループを開始します。
- **src/midi_conversion.rs**: MIDIノート番号とYM2151音源の周波数設定値など、MIDI関連のデータ変換ロジックを提供します。
- **src/models.rs**: YM2151の音色パラメータやアプリケーションの状態を表すデータ構造（構造体、enumなど）を定義しています。
- **src/register.rs**: YM2151音源の各レジスタに対応する抽象化と、それらの値を操作するためのロジックを定義しています。
- **src/tests/**: 各モジュールの単体テストコードが格納されています。
    - **app_tests.rs**: `app.rs`モジュールの機能に関するテスト。
    - **file_ops_tests.rs**: `file_ops.rs`モジュールのファイル操作に関するテスト。
    - **midi_conversion_tests.rs**: `midi_conversion.rs`モジュールのMIDI変換に関するテスト。
    - **mod.rs**: `tests`モジュールのルートファイルで、他のテストファイルを束ねます。
    - **register_tests.rs**: `register.rs`モジュールのレジスタ操作に関するテスト。
    - **ui_tests.rs**: `ui.rs`モジュールのユーザーインターフェース描画に関するテスト。
    - **verbose_logging_tests.rs**: 詳細なロギング機能に関するテスト。
- **src/ui.rs**: `ratatui`と`crossterm`を使用して、ターミナル上にアプリケーションのユーザーインターフェース（音色パラメータ表示、カーソルなど）を描画するロジックを実装しています。
- **tones/general_midi/000_AcousticGrand.json**: General MIDI互換の音色データ例として、「アコースティックグランドピアノ」のYM2151音色パラメータがJSON形式で保存されています。
- **ym2151-tone-editor.toml.example**: アプリケーションの設定ファイル（`config.rs`で読み込まれる）の例であり、キーバインドなどのカスタマイズ可能な設定を示しています。

## 関数詳細説明
プロジェクト情報から具体的な関数名やシグネチャを特定することはできませんでしたが、一般的なTUIアプリケーションの責務に基づき、主要な機能グループとその役割を以下に示します。

- **アプリケーション初期化処理**:
    - **役割**: アプリケーションの起動時に必要な各種設定、リソース（例: TUI、オーディオサーバー接続）の準備を行います。
    - **機能**: ターミナルの初期化、`ym2151-log-play-server`の起動と接続、初期音色データのロード、設定ファイルの読み込みなどが含まれます。
- **ユーザーイベント処理**:
    - **役割**: キーボード入力、マウス操作などのユーザーからのイベントを検知し、アプリケーションの状態に反映させます。
    - **機能**: カーソル移動、パラメータ値の増減、音色プレビューの開始、アプリケーション終了コマンドの検出などを行います。
- **UI描画処理**:
    - **役割**: アプリケーションの現在の状態に基づいて、ターミナル上に音色パラメータ、カーソル、メッセージなどを描画します。
    - **機能**: YM2151の各パラメータ（DT, MUL, TLなど）の表示更新、アクティブなパラメータのハイライト、操作説明の表示などを行います。
- **音色データ操作処理**:
    - **役割**: YM2151音源のパラメータを読み書きし、音色データの状態を管理します。
    - **機能**: 特定のパラメータの値を設定・取得、ランダム値の生成、複数のオペレーター（M1, C1, M2, C2）に対する操作などを行います。
- **リアルタイムオーディオフィードバック処理**:
    - **役割**: 現在編集中の音色をYM2151音源で再生し、ユーザーに即座に音声フィードバックを提供します。
    - **機能**: パラメータ変更時にレジスタ書き込みコマンドをオーディオサーバーに送信、または完全な音色データをJSON形式で送信して音を再生します。
- **ファイル入出力処理**:
    - **役割**: 音色データをファイルに保存したり、ファイルから読み込んだりします。
    - **機能**: アプリケーション終了時の自動セーブ、次回起動時の自動ロード、JSON形式での音色データ（registers, mml, descriptionなど）の解析と保存などを行います。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした

---
Generated at: 2025-11-25 07:08:17 JST
