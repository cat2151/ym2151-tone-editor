Last updated: 2025-11-11

# Project Overview

## プロジェクト概要
- YM2151 (OPM) FMシンセサイザーの音色パラメータを編集するためのエディタです。
- Rust言語で開発されており、テキストベースのユーザーインターフェース (TUI) を提供します。
- Windows環境で動作し、直感的なキー操作で音色データの作成・調整を可能にします。

## 技術スタック
- フロントエンド:
    -   `ratatui` 0.28: 高機能なテキストユーザーインターフェース（TUI）を構築するためのRust製フレームワークです。パラメータ表示やカーソル操作など、ユーザーとの対話部分を担います。
    -   `crossterm` 0.28: クロスプラットフォームに対応したターミナル操作ライブラリです。キー入力の検出、カーソルの移動、画面のクリアなど、低レベルなターミナル操作を抽象化して提供します。
- 音楽・オーディオ:
    -   YM2151 (OPM) FMシンセサイザー: ヤマハ製のFM音源チップであり、このエディタがターゲットとする音源です。FM音源の音色データ構造を扱います。
- 開発ツール:
    -   Rust 1.70+: 安全性、パフォーマンス、並行性を重視したプログラミング言語です。このプロジェクトの基盤言語として採用されています。
- ビルドツール:
    -   Cargo: Rustの公式ビルドシステムおよびパッケージマネージャーです。プロジェクトのコンパイル、依存関係の管理、テストの実行などを行います。
- 言語機能:
    -   Rustの構造体とenum: YM2151の音色データやアプリケーションの状態を型安全に表現するために使用されます。
    -   エラーハンドリング: RustのResult型とErrorトレイトにより、堅牢なエラー処理が実装されています。
- 自動化・CI/CD:
    -   (情報なし)
- 開発標準:
    -   (情報なし)

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 src/
  📄 main.rs
```

## ファイル詳細説明
-   `.gitignore`: Gitによるバージョン管理から除外するファイルやディレクトリ（ビルド生成物、一時ファイルなど）を指定します。
-   `Cargo.lock`: プロジェクトの依存関係の正確なバージョンとハッシュを記録するファイルです。これにより、異なる環境でも一貫したビルドが保証されます。
-   `Cargo.toml`: Rustプロジェクトのマニフェストファイルです。プロジェクトの名前、バージョン、作者情報、外部ライブラリ（`ratatui`, `crossterm`など）の依存関係が定義されています。
-   `LICENSE`: このプロジェクトのソフトウェアライセンス（利用条件、再配布条件など）を記述しています。
-   `README.md`: プロジェクトの概要、目的、主な機能、セットアップ方法、実行方法、操作方法といった基本的な情報が記述された主要なドキュメントファイルです。
-   `_config.yml`: Jekyllなどの静的サイトジェネレーターでドキュメントサイト（例: GitHub Pages）を構築する際に使用される設定ファイルです。
-   `generated-docs/`: 生成されたドキュメントやビルド成果物、テストレポートなどが格納される可能性のあるディレクトリです。
-   `src/`: プロジェクトのソースコードが格納されるディレクトリです。
    -   `main.rs`: アプリケーションのメインエントリーポイントとなるRustのソースファイルです。ターミナルの初期化、TUIの描画ロジック、キー入力イベント処理、YM2151音色データの管理などが実装されています。

## 関数詳細説明
このプロジェクトは、主に`src/main.rs`内に以下の役割を持つ関数群で構成されていると想定されます。

-   **アプリケーションの初期化と実行**:
    -   ターミナルの設定（Rawモードへの切り替えなど）、アプリケーションの状態（YM2151音色データ、カーソル位置など）の初期化を行います。
    -   メインのイベントループを開始し、ユーザー操作を待ち受け、UIを更新し続けます。
    -   アプリケーション終了時にターミナルを元の状態に復元する処理も含まれます。
-   **UI描画**:
    -   現在のYM2151パラメータ（DT, MUL, TLなど）とその値、および現在のカーソル位置をテキストユーザーインターフェース上に表示するためのロジックを含みます。`ratatui`ライブラリを使用して、画面の各要素を描画します。
-   **イベントハンドリング**:
    -   ユーザーからのキー入力イベント（`h, j, k, l`によるカーソル移動、`q, e`による値の増減、`ESC`による終了など）を検出し、それに応じた内部状態の更新を行います。
    -   パラメータの値が増減した際には、最大値/最小値を考慮した処理が実行されます。
-   **YM2151データ管理**:
    -   YM2151の音色パラメータを保持するデータ構造（例: `ToneData`）の初期化（基本的なFMピアノのような音色）を行います。
    -   現在の音色データをJSON形式でファイルに保存する処理、および起動時にJSONファイルから音色データを読み込む処理を管理します。

## 関数呼び出し階層ツリー
```
アプリケーション起動
└── ターミナル初期化
└── アプリケーションメインループ
    ├── 音色データ初期化 (またはJSONからの読み込み)
    ├── {ループ開始}
    │   ├── UI描画処理
    │   │   └── YM2151パラメータ表示
    │   │   └── カーソル表示
    │   └── キー入力イベント処理
    │       ├── カーソル移動処理 (h, j, k, l)
    │       ├── パラメータ値増減処理 (q, e)
    │       └── 終了/保存処理 (ESC)
    │           └── 現在の音色データをJSON形式で保存
    │           └── {ループ終了}
    └── {ループ終了}
└── ターミナル復元
アプリケーション終了

---
Generated at: 2025-11-11 09:27:31 JST
