Last updated: 2025-11-22

# Project Overview

## プロジェクト概要
- YM2151 FM音源の音色を直感的に編集するためのWindows向けテキストユーザーインターフェース（TUI）エディタです。
- リアルタイム音声フィードバックと視覚的なパラメータ表示により、音色の調整と確認をスムーズに行えます。
- シンプルな操作性とGitHubでの管理に適した音色データ形式を特徴とし、開発中の音作り体験向上を目指しています。

## 技術スタック
- フロントエンド: 
    - `ratatui` (0.28): Rust製のターミナルUIフレームワークで、複雑なTUIアプリケーションを構築するためのツールセットを提供します。
    - `crossterm` (0.28): クロスプラットフォーム対応のターミナル操作ライブラリで、キーボード入力、マウスイベント、画面描画などの低レベルなターミナル操作を抽象化します。
- 音楽・オーディオ: 
    - `ym2151-log-play-server`: リアルタイム音声フィードバックを提供するための外部サーバーと連携するライブラリです。音色データをサーバーに送信し、即座に音を確認できます。
- 開発ツール: 
    - Rustの標準ツールチェイン: コンパイラ、パッケージマネージャー（Cargo）など、Rustプロジェクト開発の基本的なツール群です。
- テスト: 
    - Rustの標準テストフレームワーク: `src/tests`ディレクトリにテストコードが配置されており、Rust言語に組み込まれたテスト機能を活用しています。
- ビルドツール: 
    - `cargo`: Rust言語の公式パッケージマネージャー兼ビルドシステムです。依存関係の管理、プロジェクトのビルド、テスト、実行などを一元的に行います。
- 言語機能: 
    - `Rust`: 安全性、並行性、性能を重視したシステムプログラミング言語です。信頼性の高いアプリケーション開発に適しています。
- 自動化・CI/CD: 
    - （情報なし）
- 開発標準: 
    - （情報なし）

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📁 docs/
  📖 KEYBINDS.ja.md
📁 generated-docs/
📁 issue-notes/
  📖 55.md
  📖 57.md
  📖 59.md
  📖 61.md
  📖 62.md
  📖 65.md
  📖 66.md
  📖 68.md
  📖 70.md
  📖 72.md
  📖 75.md
  📖 77.md
  📖 79.md
  📖 81.md
  📖 83.md
  📖 85.md
  📖 87.md
  📖 89.md
  📖 91.md
  📖 93.md
📁 src/
  📄 app.rs
  📄 audio.rs
  📄 config.rs
  📄 file_ops.rs
  📄 main.rs
  📄 midi_conversion.rs
  📄 models.rs
  📄 register.rs
  📁 tests/
    📄 app_tests.rs
    📄 file_ops_tests.rs
    📄 midi_conversion_tests.rs
    📄 mod.rs
    📄 register_tests.rs
    📄 ui_tests.rs
    📄 verbose_logging_tests.rs
  📄 ui.rs
📁 tones/
  📁 general_midi/
    📊 000_AcousticGrand.json
📄 ym2151-tone-editor.toml.example
```

## ファイル詳細説明
- **`.gitignore`**: Gitによるバージョン管理から除外するファイルやディレクトリを指定します。
- **`Cargo.lock`**: `Cargo.toml`に記述された依存関係の正確なバージョンとハッシュを記録し、再現性のあるビルドを保証します。
- **`Cargo.toml`**: Rustプロジェクトのビルド設定ファイルです。プロジェクトのメタデータ、依存クレート、機能などを定義します。
- **`LICENSE`**: プロジェクトのソフトウェアライセンス情報（著作権、利用条件など）を含んでいます。
- **`README.ja.md`**: プロジェクトの日本語版の説明書です。概要、機能、使用方法などが記述されています。
- **`README.md`**: プロジェクトの英語版の説明書です。日本語版と同様の内容が英語で記述されています。
- **`_config.yml`**: GitHub Pagesなどの静的サイトジェネレーターで利用される設定ファイルです。
- **`docs/KEYBINDS.ja.md`**: アプリケーションのキーバインド（操作キー）に関する日本語ドキュメントです。
- **`generated-docs/`**: 自動生成されたドキュメントやレポートを格納するためのディレクトリです。
- **`issue-notes/`**: プロジェクト開発中に発生した課題や検討事項、解決策のメモを記録したファイル群です。
- **`src/app.rs`**: アプリケーションの主要な状態管理、ビジネスロジック、イベント処理を定義します。ユーザー入力に応じて状態を更新し、UIやオーディオモジュールと連携します。
- **`src/audio.rs`**: YM2151のリアルタイム音声フィードバックを担当するモジュールです。外部の`ym2151-log-play-server`ライブラリと連携し、音色データをサーバーに送信して再生を制御します。
- **`src/config.rs`**: アプリケーションの設定（キーバインド、コマンドラインオプションなど）を読み込み、管理するモジュールです。
- **`src/file_ops.rs`**: ファイルシステム操作を担当するモジュールです。音色データのJSON形式での保存や読み込み、設定ファイルの処理などを行います。
- **`src/main.rs`**: アプリケーションのエントリポイントです。プログラムの起動時に最初に実行され、`app::App`を初期化してメインループを開始します。
- **`src/midi_conversion.rs`**: MIDIノート番号とYM2151音源の周波数設定（DT, MULなど）の間で変換を行うロジックを扱います。
- **`src/models.rs`**: YM2151音源のパラメータ構造、音色データ形式、ユーザーインターフェースの状態など、アプリケーションで使用される主要なデータモデルを定義します。
- **`src/register.rs`**: YM2151音源のレジスタ操作に関するロジックをカプセル化します。特定のパラメータ値からレジスタ値を計算したり、その逆を行ったりします。
- **`src/tests/`**: アプリケーションの各種モジュールに対するユニットテストコードを格納するディレクトリです。
    - **`src/tests/app_tests.rs`**: `app.rs`モジュールのテストコードです。
    - **`src/tests/file_ops_tests.rs`**: `file_ops.rs`モジュールのテストコードです。
    - **`src/tests/midi_conversion_tests.rs`**: `midi_conversion.rs`モジュールのテストコードです。
    - **`src/tests/mod.rs`**: `tests`モジュール全体の定義ファイルです。
    - **`src/tests/register_tests.rs`**: `register.rs`モジュールのテストコードです。
    - **`src/tests/ui_tests.rs`**: `ui.rs`モジュールのテストコードです。
    - **`src/tests/verbose_logging_tests.rs`**: 詳細なログ出力機能に関するテストコードです。
- **`src/ui.rs`**: ターミナルユーザーインターフェース (TUI) の描画ロジックを定義します。`ratatui`クレートを使用して、YM2151のパラメータグリッド、カーソル、情報表示などを画面にレンダリングします。
- **`tones/general_midi/000_AcousticGrand.json`**: General MIDIの基準に準拠したアコースティックグランドピアノの音色サンプルデータです。このファイルは、提案されている音色保存フォーマットの例を示しています。
- **`ym2151-tone-editor.toml.example`**: アプリケーションの設定ファイル`ym2151-tone-editor.toml`のサンプルです。キーバインドなどのカスタマイズ可能な設定項目が記述されています。

## 関数詳細説明
- `main()`
    - 役割: アプリケーションのエントリポイント。初期設定を行い、メインアプリケーションループを開始します。
    - 引数: なし。
    - 戻り値: `Result<(), Box<dyn Error>>` (成功またはエラーを示す)。
    - 機能: `App`構造体を初期化し、`run`メソッドを呼び出してTUIイベント処理を開始します。
- `app::App::run()`
    - 役割: アプリケーションのメインループを実行し、ユーザー入力、UI更新、音声フィードバックを管理します。
    - 引数: `&mut self` (アプリケーションインスタンス自身)。
    - 戻り値: `Result<(), Box<dyn Error>>`。
    - 機能: `crossterm`でターミナルを初期化し、イベントループ内でキー入力やマウスイベントを処理し、`ui::draw`を呼び出して画面を更新し、`audio`モジュール経由で音色を再生します。
- `ui::draw()`
    - 役割: 現在のアプリケーション状態に基づいてターミナルUIを描画します。
    - 引数: `&mut Frame`, `&App` (描画フレームとアプリケーション状態)。
    - 戻り値: なし。
    - 機能: YM2151のパラメータグリッド、カーソル、操作説明などを画面にレンダリングします。
- `audio::play_tone()`
    - 役割: 現在編集中のYM2151音色データを外部サーバーに送信し、音声フィードバックを生成します。
    - 引数: `&ToneData` (YM2151音色データ)。
    - 戻り値: `Result<(), io::Error>`。
    - 機能: `ym2151-log-play-server`ライブラリの機能を使用し、レガシーモードまたはインタラクティブモードで音色データを送信します。
- `file_ops::save_tone_data()`
    - 役割: 現在の音色データをJSONファイルとして保存します。
    - 引数: `&ToneData`, `&Path` (音色データと保存先パス)。
    - 戻り値: `Result<(), io::Error>`。
    - 機能: YM2151音色データを指定されたファイルパスにシリアライズして書き込みます。
- `file_ops::load_latest_tone_data()`
    - 役割: アプリケーション起動時に前回の音色データをJSONファイルから読み込みます。
    - 引数: `&Path` (読み込み元パス)。
    - 戻り値: `Result<ToneData, io::Error>`。
    - 機能: 指定されたファイルパスからJSONデータをデシリアライズして`ToneData`構造体として返します。
- `register::set_parameter()`
    - 役割: YM2151の特定レジスタにパラメータ値を設定します。
    - 引数: `&mut ToneData`, `ParameterType`, `usize`, `u8` (音色データ、パラメータ種別、オペレータ番号、値)。
    - 戻り値: なし。
    - 機能: 指定されたパラメータ（DT, MUL, TLなど）を、対応するYM2151レジスタ値に変換して音色データ内部に反映させます。

## 関数呼び出し階層ツリー
```
提供された情報からは関数の呼び出し階層を特定できませんでした。

---
Generated at: 2025-11-22 07:08:37 JST
