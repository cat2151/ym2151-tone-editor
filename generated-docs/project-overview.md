Last updated: 2025-12-02

# Project Overview

## プロジェクト概要
- YM2151 FM音源の音色を直感的に編集できるWindows向けターミナルUIエディタです。
- マウスやキーボード操作で音色パラメータをリアルタイムに調整し、すぐに音色の変化を確認できます。
- 編集した音色は自動で保存され、次回起動時に前回の状態から編集を再開できます。

## 技術スタック
- フロントエンド: 
    - `ratatui` 0.28: ターミナルUI (TUI) の構築に使用されるRustフレームワークで、複雑なユーザーインターフェースをコマンドライン上で実現します。
    - `crossterm` 0.28: クロスプラットフォームに対応したターミナル操作ライブラリで、キーボードイベントやマウスイベントの処理、カーソル制御、画面描画など、ターミナルとの低レベルなインタラクションを提供します。
- 音楽・オーディオ: 
    - `ym2151-log-play-server` ライブラリ: YM2151音源のリアルタイムオーディオフィードバックを処理するサーバーとの連携に使用され、インタラクティブな音色プレビューを可能にします。
- 開発ツール: 
    - `Rust`: プロジェクトの主要なプログラミング言語。高い安全性とパフォーマンスを特徴とします。
- テスト: 
    - `Rust標準テストフレームワーク`: プロジェクト内の各モジュール（例: `app_tests`, `file_ops_tests`など）の機能を検証するために利用されます。
- ビルドツール: 
    - `Cargo`: Rustの公式ビルドシステムおよびパッケージマネージャーで、依存関係の管理、プロジェクトのビルド、テスト実行を効率的に行います。
- 言語機能: 
    - `Rust`: メモリ安全性を保証しつつ、高いパフォーマンスを実現するための言語機能（所有権システム、ライフタイム、パターンマッチングなど）が活用されています。
- 自動化・CI/CD: 
    - (プロジェクト情報に具体的な記載はありません。)
- 開発標準: 
    - (プロジェクト情報に具体的な記載はありません。)

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📁 docs/
  📖 KEYBINDS.ja.md
📁 generated-docs/
🌐 googled947dc864c270e07.html
📁 issue-notes/
  📖 100.md
  📖 101.md
  📖 102.md
  📖 103.md
  📖 104.md
  📖 105.md
  📖 106.md
  📖 107.md
  📖 108.md
  📖 109.md
  📖 110.md
  📖 111.md
  📖 112.md
  📖 113.md
  📖 114.md
  📖 115.md
  📖 116.md
  📖 95.md
  📖 96.md
  📖 97.md
  📖 99.md
📁 src/
  📄 app.rs
  📄 app_init.rs
  📄 audio.rs
  📄 config.rs
  📄 file_ops.rs
  📄 main.rs
  📄 midi_conversion.rs
  📄 models.rs
  📄 register.rs
  📁 tests/
    📄 app_tests.rs
    📄 file_ops_tests.rs
    📄 midi_conversion_tests.rs
    📄 mod.rs
    📄 register_tests.rs
    📄 ui_tests.rs
    📄 verbose_logging_tests.rs
  📄 ui.rs
📁 tones/
  📁 general_midi/
    📊 000_AcousticGrand.json
    📊 tone_names.json
📄 ym2151-tone-editor.toml.example
```

## ファイル詳細説明
- `README.ja.md`, `README.md`: プロジェクトの概要、機能、使い方、ビルド方法などを日本語と英語で説明するドキュメントです。
- `.gitignore`: Gitのバージョン管理から除外するファイルやディレクトリ（例: ビルド生成物、一時ファイルなど）を指定します。
- `Cargo.lock`: プロジェクトの依存関係ツリーの正確なバージョンを記録し、再現性のあるビルドを保証します。
- `Cargo.toml`: Rustプロジェクトの構成ファイルで、プロジェクト名、バージョン、著者、ライセンス、外部ライブラリの依存関係などを定義します。
- `LICENSE`: プロジェクトの配布および利用に関するライセンス情報を提供します。
- `_config.yml`: GitHub Pagesなどの静的サイトジェネレーター（例: Jekyll）の設定ファイルです。
- `docs/KEYBINDS.ja.md`: アプリケーションのキーバインド（操作方法）について詳細に説明する日本語ドキュメントです。
- `generated-docs/`: 自動生成されたドキュメントやリソースを格納するディレクトリです。
- `src/app.rs`: アプリケーションの主要なロジックを実装するモジュールです。UIの状態管理、イベントハンドリング、ビジネスロジックの中核を担います。
- `src/app_init.rs`: アプリケーションの起動時における初期設定やリソースの準備に関する処理を定義するモジュールです。
- `src/audio.rs`: YM2151音源のリアルタイムオーディオフィードバックに関連するロジック、特に音色プレビューのためのサーバー通信やデータ送信を管理します。
- `src/config.rs`: アプリケーションの設定（キーバインドのカスタマイズ、各種オプションなど）の読み込み、保存、管理を行うモジュールです。
- `src/file_ops.rs`: 音色データのファイルからの読み込み（ロード）やファイルへの書き出し（セーブ）といった永続化処理を扱うモジュールです。
- `src/main.rs`: プロジェクトのエントリポイントとなるファイルで、アプリケーションの起動、メインループの実行、基本的な初期化などを担当します。
- `src/midi_conversion.rs`: MIDIノート番号とYM2151の周波数パラメータ間の変換など、MIDI関連のデータ処理ロジックを格納するモジュールです。
- `src/models.rs`: YM2151の音色データ構造、アプリケーションの状態、ユーザー入力モデルなど、アプリケーション全体で使用されるデータモデルを定義します。
- `src/register.rs`: YM2151音源のレジスタ操作に関するロジック、例えばレジスタアドレスとデータ値の変換、パラメータの検証などを担当します。
- `src/tests/`: 各モジュールの単体テストや統合テストを含むテストコードを格納するディレクトリです。
- `src/ui.rs`: ターミナルユーザーインターフェース (TUI) の描画ロジックを担当するモジュールです。`ratatui`ライブラリを使用して画面のレイアウトや要素を描画します。
- `tones/general_midi/000_AcousticGrand.json`: General MIDI規格に準拠したアコースティックグランドピアノの音色データがJSON形式で格納されています。
- `tones/general_midi/tone_names.json`: 音色名のリストや関連情報を格納するJSONファイルです。
- `ym2151-tone-editor.toml.example`: アプリケーションの設定ファイル (`config.rs`で読み込む) の書式と内容を示すサンプルファイルです。

## 関数詳細説明
プロジェクトのソースコードからの直接的な関数情報が提供されていないため、一般的なRustアプリケーションの設計パターンに基づき、各モジュールに存在し得る主要な関数の役割について説明します。

- `app.rs`関連関数:
    - `run_app()`: アプリケーションのメインループを実行し、イベント処理とUI描画を管理します。
    - `handle_event(event)`: ユーザー入力（キーボード、マウス）を受け取り、それに応じたアプリケーションの状態変更を処理します。
    - `update_state()`: イベント処理の結果に基づいて、アプリケーションの状態を更新します。
- `app_init.rs`関連関数:
    - `initialize_application()`: アプリケーションの初期設定を行い、必要なリソース（例: ターミナル、オーディオサーバー接続）を準備します。
- `audio.rs`関連関数:
    - `send_tone_to_server(tone_data)`: 編集されたYM2151音色データをオーディオサーバーに送信し、リアルタイムでの音色プレビューを可能にします。
    - `ensure_server_ready()`: オーディオサーバーの起動状況を確認し、必要であれば自動的に起動・準備を行います。
- `config.rs`関連関数:
    - `load_config()`: 設定ファイルからアプリケーションの設定（キーバインドなど）を読み込みます。
    - `save_config(config_data)`: 現在の設定をファイルに保存します。
- `file_ops.rs`関連関数:
    - `load_tone_from_file(path)`: 指定されたパスからYM2151音色データを読み込みます。
    - `save_tone_to_file(path, tone_data)`: 現在編集中の音色データを指定されたパスに保存します。
- `main.rs`関連関数:
    - `main()`: プログラムのエントリポイント。アプリケーションの起動処理を呼び出し、`app.rs`のメインループを実行します。
- `midi_conversion.rs`関連関数:
    - `note_to_frequency(midi_note)`: MIDIノート番号をYM2151で使用される周波数パラメータに変換します。
- `models.rs`関連関数:
    - `new_default_tone()`: YM2151のデフォルト音色データ構造を生成します。
    - `get_parameter_range(param_name)`: 指定されたパラメータの名前からその有効範囲を返します。
- `register.rs`関連関数:
    - `set_register_value(address, value)`: YM2151の特定のレジスタアドレスに値を設定するためのデータを生成します。
    - `get_parameter_from_registers(register_data, parameter_id)`: YM2151のレジスタデータから特定の音色パラメータの値を抽出します。
- `ui.rs`関連関数:
    - `draw_ui(frame, app_state)`: 現在のアプリケーション状態に基づいて、ターミナルUIの各要素（パラメータ表示、カーソル、メッセージなど）を描画します。
    - `render_parameter_table()`: YM2151の音色パラメータを表示するテーブルを描画します。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析するための具体的な情報が提供されていないため、このセクションは省略します。

---
Generated at: 2025-12-02 07:08:11 JST
