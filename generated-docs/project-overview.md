Last updated: 2025-12-11

# Project Overview

## プロジェクト概要
- YM2151（OPM）FM音源の音色パラメータを編集するための、Windows向けターミナルユーザーインターフェース (TUI) アプリケーションです。
- Rustで開発されており、マウスやキーボード操作で音色をリアルタイムに調整し、音声フィードバックと自動セーブ機能を提供します。
- シンプルな操作性と視覚的なフィードバックを通じて、FM音源の音色作成・調整プロセスを支援します。

## 技術スタック
- フロントエンド: `ratatui` 0.28 (TUIフレームワークとして画面描画を担当)、`crossterm` 0.28 (クロスプラットフォームのターミナル操作を抽象化し、キー入力やマウスイベントなどを処理)
- 音楽・オーディオ: `ym2151-log-play-server` (リアルタイム音声フィードバック用のサーバーを自動セットアップ・起動し、音色変更時のレジスタ書き込みを効率的に送信)、`mmlabc-to-smf-rust` (MML（Music Macro Language）をSMF（Standard MIDI File）データに変換)、`smf-to-ym2151log-rust` (SMFデータと音色情報をYM2151用のログデータに変換し、サーバーへ送信可能な形式に加工)
- 開発ツール: `cargo` (Rustの公式パッケージマネージャー兼ビルドシステム。プロジェクトのビルド、依存関係の管理、テスト実行に使用)
- テスト: Rustの組み込みテストフレームワーク (単体テストや統合テストの記述、実行に使用)
- ビルドツール: `cargo` (Rustコードのコンパイル、最適化、バイナリ生成を一元的に管理)
- 言語機能: Rust 1.70 以降 (安全性、並行性、パフォーマンスに優れたシステムプログラミング言語)
- 自動化・CI/CD: (プロジェクト情報からは直接的な記載がありませんが、RustのエコシステムではGitHub Actionsなどが一般的に利用されます)
- 開発標準: `.gitignore` (Git管理から除外するファイルを定義)、`LICENSE` (プロジェクトのライセンス情報を明記)、`Cargo.toml` (Rustプロジェクトのマニフェストファイル。依存関係、メタデータ、ビルド設定などを記述)

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📖 README_generate_gm_templates.md
📄 _config.yml
📁 docs/
  📖 KEYBINDS.ja.md
📄 generate_gm_templates.rs
📁 generated-docs/
🌐 googled947dc864c270e07.html
📁 issue-notes/
  📖 100.md
  📖 101.md
  📖 102.md
  📖 103.md
  📖 104.md
  📖 105.md
  📖 106.md
  📖 107.md
  📖 108.md
  📖 109.md
  📖 110.md
  📖 111.md
  📖 112.md
  📖 113.md
  📖 114.md
  📖 115.md
  📖 116.md
  📖 130.md
  📖 134.md
  📖 136.md
  📖 138.md
  📖 139.md
  📖 141.md
  📖 144.md
  📖 146.md
  📖 147.md
  📖 148.md
  📖 149.md
  📖 150.md
  📖 151.md
  📖 155.md
  📖 156.md
  📖 158.md
  📖 164.md
  📖 165.md
  📖 166.md
  📖 167.md
  📖 95.md
  📖 96.md
  📖 97.md
  📖 99.md
📁 src/
  📄 app.rs
  📄 app_init.rs
  📄 audio.rs
  📄 config.rs
  📄 file_ops.rs
  📄 main.rs
  📄 midi_conversion.rs
  📄 models.rs
  📄 register.rs
  📁 tests/
    📄 app_tests.rs
    📄 file_ops_tests.rs
    📄 midi_conversion_tests.rs
    📄 mod.rs
    📄 register_tests.rs
    📄 ui_tests.rs
    📄 variation_selector_tests.rs
    📄 verbose_logging_tests.rs
  📄 ui.rs
  📄 variation_selector.rs
📁 tones/
  📁 general_midi/
    📊 000_AcousticGrand.json
    📊 tone_names.json
📄 ym2151-tone-editor.toml.example
```

## ファイル詳細説明
- **`.gitignore`**: Gitのバージョン管理から特定のファイルやディレクトリを除外するための設定ファイルです。
- **`Cargo.lock`**: Rustプロジェクトの依存関係の正確なバージョンを記録し、ビルドの再現性を保証するファイルです。
- **`Cargo.toml`**: Rustプロジェクトのマニフェストファイル。プロジェクト名、バージョン、著者、依存クレート（ライブラリ）などが定義されています。
- **`LICENSE`**: プロジェクトの配布および使用に関するライセンス情報が記述されています。
- **`README.ja.md`**, **`README.md`**: それぞれ日本語版と英語版のプロジェクト概要、機能、使い方、ビルド方法などが記載された主要なドキュメントです。
- **`README_generate_gm_templates.md`**: General MIDIテンプレートの生成に関する詳細を説明するドキュメントです。
- **`_config.yml`**: Jekyllなどの静的サイトジェネレータで使用される設定ファイルで、おそらくGitHub Pagesでのドキュメント公開に利用されます。
- **`docs/KEYBINDS.ja.md`**: アプリケーションのキーバインド（キー操作）に関する詳細な日本語ドキュメントです。
- **`generate_gm_templates.rs`**: General MIDIの音色テンプレートを生成するためのRustスクリプトファイルです。
- **`googled947dc864c270e07.html`**: Googleサイトの所有権確認に使用されるHTMLファイルです。
- **`issue-notes/`**: 開発中に発生した問題や検討事項、機能追加のアイデアなどが個別のMarkdownファイルとして記録されているディレクトリです。
- **`src/app.rs`**: アプリケーションの主要なロジックと状態管理を担当するモジュールです。UIの状態、音色データ、イベント処理などが含まれます。
- **`src/app_init.rs`**: アプリケーションの初期化処理、例えば設定の読み込みや初期状態の設定などを行うモジュールです。
- **`src/audio.rs`**: リアルタイム音声フィードバックに関するロジックが実装されているモジュールです。YM2151サーバーとの連携や音色プレビュー機能を管理します。
- **`src/config.rs`**: アプリケーションの設定（キーバインドや動作モードなど）の読み書き、管理を行うモジュールです。
- **`src/file_ops.rs`**: ファイル操作に関するロジックをまとめたモジュールです。音色データのセーブ/ロード、設定ファイルの読み書きなどを担当します。
- **`src/main.rs`**: アプリケーションのエントリーポイントです。起動処理、ターミナルUIの初期化、イベントループの実行などを担当します。
- **`src/midi_conversion.rs`**: MMLからSMF、SMFからYM2151ログへの変換といったMIDI関連のデータ変換ロジックを扱うモジュールです。
- **`src/models.rs`**: アプリケーション内で使用される様々なデータ構造（音色パラメータ、キーバインド設定、UI表示データなど）が定義されているモジュールです。
- **`src/register.rs`**: YM2151のレジスタ操作に関するロジックが含まれています。音色パラメータとYM2151のハードウェアレジスタ値との変換などを処理します。
- **`src/tests/`**: アプリケーションの各モジュールに対する単体テストや統合テストが記述されているディレクトリです。
- **`src/ui.rs`**: ターミナルユーザーインターフェース (TUI) の描画ロジックを担当するモジュールです。`ratatui` クレートを使用して画面要素を構築し表示します。
- **`src/variation_selector.rs`**: 音色のバリエーション選択や管理に関するロジックを実装したモジュールです。
- **`tones/general_midi/000_AcousticGrand.json`**: General MIDIの「Acoustic Grand Piano」カテゴリの音色データとそのバリエーションをJSON形式で格納しています。
- **`tones/general_midi/tone_names.json`**: 音色名のリストをJSON形式で格納しており、音色管理や表示に利用されます。
- **`ym2151-tone-editor.toml.example`**: アプリケーションの設定ファイル（`config.rs`で読み込まれる）の記述例です。ユーザーがカスタマイズする際のテンプレートとして提供されます。

## 関数詳細説明
このプロジェクトでは、具体的な関数リストが提供されていませんが、プロジェクトの機能から以下の役割を持つ関数群が存在すると推測できます。

- **`main()`**:
    - 役割: アプリケーションのエントリーポイントであり、初期化からメインループ、終了処理までを統括します。
    - 機能: アプリケーションの起動、TUIの初期設定、イベントループの開始、リソースのクリーンアップなど。
- **`run_app(app_state)`**:
    - 役割: アプリケーションのメインロジックを実行し、ユーザーとのインタラクションを処理します。
    - 機能: ユーザーからの入力イベント（キーボード、マウス）を受け取り、それに基づいてアプリケーションの状態を更新し、UIを再描画します。
- **`update_state(event, app_state)`**:
    - 役割: 発生したイベントに基づいてアプリケーションの状態を変更します。
    - 機能: キー入力によるカーソル移動や値の増減、マウス操作によるUI要素の選択や値の変更、音色プレビューのトリガーなどを処理します。
- **`render_ui(frame, app_state)`**:
    - 役割: 現在のアプリケーションの状態に基づいてターミナルUIを描画します。
    - 機能: YM2151の音色パラメータ、各種設定、メッセージなどを画面上に表示します。`ratatui` クレートを利用して視覚的な要素を配置します。
- **`play_tone(tone_data)`**:
    - 役割: 現在編集中の音色をリアルタイムでプレビュー再生します。
    - 機能: `ym2151-log-play-server` と連携し、音色データをサーバーに送信して音源からの音声フィードバックを得ます。
- **`save_tone(tone_data)`**:
    - 役割: 現在の音色データをファイルに保存します。
    - 機能: 終了時などに自動的に音色設定を保存し、次回起動時に続きから編集できるようにします。
- **`load_tone()`**:
    - 役割: 以前保存された音色データや設定ファイルを読み込みます。
    - 機能: アプリケーション起動時に前回の編集状態やユーザー設定を復元します。
- **`ensure_server_ready()`**:
    - 役割: リアルタイム音声フィードバック用のサーバー (`ym2151-log-play-server`) の準備を確実にします。
    - 機能: サーバーが未起動の場合は自動的に起動し、通信可能な状態であることを確認します。
- **`convert_mml_to_smf(mml_string)`**:
    - 役割: MML形式の文字列をSMFデータに変換します。
    - 機能: 音楽的な記述を標準MIDIファイル形式に変換し、後の処理で利用できるようにします。
- **`convert_smf_to_ym2151_log(smf_data, tone_data)`**:
    - 役割: SMFデータと音色データをYM2151レジスタのログ形式に変換します。
    - 機能: YM2151サーバーに送信するための具体的なレジスタ操作コマンドを生成します。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした

---
Generated at: 2025-12-11 07:09:20 JST
