Last updated: 2025-11-28

# Project Overview

## プロジェクト概要
- YM2151 FM音源の音色を編集するための、Windows向けのターミナルユーザーインターフェース (TUI) アプリケーションです。
- マウスやキーボード操作で音色パラメータをリアルタイムに調整し、すぐに音声でフィードバックを確認できます。
- 編集中の音色は自動的に保存され、次回起動時に前回の続きから編集可能な開発中のツールです。

## 技術スタック
- フロントエンド: 
  - `ratatui` (0.28): ターミナル上でリッチなユーザーインターフェースを構築するためのフレームワークです。
  - `crossterm` (0.28): クロスプラットフォームでターミナル操作（イベント処理、カーソル移動など）を行うためのライブラリです。
- 音楽・オーディオ: 
  - `ym2151-log-play-server`: リアルタイムでYM2151音源のサウンドを生成し、音色エディタに変更をフィードバックするためのWindows専用サーバーライブラリです。エディタが自動で起動・管理します。
- 開発ツール: 
  - `Rust 1.70 以降`: パフォーマンスと安全性を重視したシステムプログラミング言語で、本プロジェクトの主要な開発言語です。
  - `cargo`: Rustの公式ビルドシステムおよびパッケージマネージャーで、依存関係の管理、ビルド、テスト、実行を効率化します。
- テスト: 
  - Rustの組み込みテストフレームワーク: `src/tests/` ディレクトリに各種モジュールのテストコードが配置されており、アプリケーションの品質を保証するために利用されています。
- ビルドツール: 
  - `cargo`: 上記の通り、Rustプロジェクトのビルドを管理します。
- 言語機能: 
  - `Rust`: 型安全性、メモリ安全性、並行処理を強力にサポートする現代的なプログラミング言語です。
- 自動化・CI/CD: 
  - `ensure_server_ready()`関数: `ym2151-log-play-server`ライブラリの一部として、オーディオサーバーのセットアップと起動を自動化し、開発者が手動でサーバーを操作する手間を省きます。
- 開発標準: 
  - 特に明記されていませんが、Rustコミュニティの標準的なコーディング規約やツール（例: `rustfmt`）に従って開発が行われていると推測されます。

## ファイル階層ツリー
```
📄 .gitignore
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📁 docs/
  📖 KEYBINDS.ja.md
📁 generated-docs/
📁 issue-notes/
  📖 100.md
  📖 101.md
  📖 102.md
  📖 103.md
  📖 104.md
  📖 105.md
  📖 106.md
  📖 107.md
  📖 108.md
  📖 109.md
  📖 110.md
  📖 111.md
  📖 112.md
  📖 113.md
  📖 114.md
  📖 115.md
  📖 116.md
  📖 95.md
  📖 96.md
  📖 97.md
  📖 99.md
📁 src/
  📄 app.rs
  📄 app_init.rs
  📄 audio.rs
  📄 config.rs
  📄 file_ops.rs
  📄 main.rs
  📄 midi_conversion.rs
  📄 models.rs
  📄 register.rs
  📁 tests/
    📄 app_tests.rs
    📄 file_ops_tests.rs
    📄 midi_conversion_tests.rs
    📄 mod.rs
    📄 register_tests.rs
    📄 ui_tests.rs
    📄 verbose_logging_tests.rs
  📄 ui.rs
📁 tones/
  📁 general_midi/
    📊 000_AcousticGrand.json
    📊 tone_names.json
📄 ym2151-tone-editor.toml.example
```

## ファイル詳細説明
- **`.gitignore`**: Gitがバージョン管理から無視するファイルやディレクトリを指定します。
- **`Cargo.lock`**: `Cargo.toml`で定義された依存関係の正確なバージョンとチェックサムを記録し、ビルドの再現性を保証します。
- **`Cargo.toml`**: Rustプロジェクトのマニフェストファイル。プロジェクトのメタデータ（名前、バージョンなど）と、プロジェクトが依存する外部ライブラリを定義します。
- **`LICENSE`**: プロジェクトのライセンス情報（著作権、利用条件など）が記述されています。
- **`README.ja.md`, `README.md`**: プロジェクトの概要、機能、ビルド方法、使い方などを説明する多言語（日本語、英語）のドキュメントです。
- **`_config.yml`**: GitHub Pagesなどで使用されるJekyllなどの静的サイトジェネレータの設定ファイルであると推測されます。
- **`docs/KEYBINDS.ja.md`**: アプリケーションのキーバインドに関する詳細な説明が日本語で記述されています。
- **`src/main.rs`**: アプリケーションのエントリーポイントです。主要な初期化処理を行い、アプリケーションのメインループを開始します。
- **`src/app.rs`**: アプリケーションのコアロジックを定義します。ユーザーインターフェースの状態管理、イベント処理、データ更新といったアプリケーションの振る舞いを司ります。
- **`src/app_init.rs`**: アプリケーションの起動時に必要な初期化処理（設定の読み込み、オーディオサーバーの準備など）をまとめています。
- **`src/audio.rs`**: YM2151オーディオサーバーとの通信を担当するモジュールです。音色データの送信やリアルタイム音声フィードバックの管理を行います。
- **`src/config.rs`**: アプリケーションの設定（キーバインドなど）をファイルから読み込み、管理するためのロジックを定義します。
- **`src/file_ops.rs`**: 音色データの保存、読み込み、削除など、ファイルシステムに関する操作を処理します。
- **`src/midi_conversion.rs`**: MIDI関連のデータ形式やイベントと、YM2151のレジスタ値との間の変換ロジックを扱います。
- **`src/models.rs`**: アプリケーション内で使用される主要なデータ構造（例: YM2151のオペレーターパラメータ、音色データ）を定義します。
- **`src/register.rs`**: YM2151の各種レジスタ（Detune, Multiplierなど）に関するデータ構造、値の範囲、操作ロジックを定義します。
- **`src/tests/`**: 各モジュール（`app`, `file_ops`, `midi_conversion`, `register`, `ui`など）の機能を検証するための単体テストコードが格納されています。
- **`src/ui.rs`**: `ratatui`ライブラリを使用して、ターミナルユーザーインターフェース（TUI）の描画ロジックを実装します。画面上のテキスト、コントロール、レイアウトなどを定義します。
- **`tones/general_midi/000_AcousticGrand.json`**: General MIDIの「アコースティックグランドピアノ」に相当する音色データ例がJSON形式で格納されています。
- **`tones/general_midi/tone_names.json`**: 音色の名前リストなどのデータがJSON形式で格納されています。
- **`ym2151-tone-editor.toml.example`**: アプリケーションの設定ファイルである`ym2151-tone-editor.toml`のサンプルです。ユーザーはこれを基にキーバインドなどをカスタマイズできます。

## 関数詳細説明
このプロジェクトでは、主に以下のような役割を持つ関数群がアプリケーションの動作を構成していると推測されます。

- `main()`: アプリケーションの起動時のエントリポイントであり、初期設定、アプリケーションの主要な実行ループの開始、および終了時のクリーンアップ処理を担当します。
- `run()`: アプリケーションのメインイベントループを実行する関数で、ユーザー入力の監視、アプリケーション状態の更新、UIの再描画、オーディオフィードバックの管理といった一連の処理を繰り返します。
- `handle_event(event)`: ユーザーからの入力イベント（キーボード入力、マウス操作など）を受け取り、そのイベントに基づいてアプリケーションの内部状態を変更するロジックを処理します。
  - 引数: `event` (ユーザー入力イベントのデータ)
  - 戻り値: なし (または、アプリケーションの継続/終了を示すフラグ)
- `update_state()`: アプリケーションの現在の状態（例: カーソル位置、選択中のパラメータ、編集中のパラメータ値）を、ユーザー入力や内部ロジックに基づいて更新します。
- `draw_ui(frame, app_state)`: 現在のアプリケーションの状態（`app_state`）に基づいて、ターミナル上にユーザーインターフェース要素を描画します。`ratatui`の描画コンテキスト(`frame`)を使用して各UIコンポーネントを配置します。
  - 引数: `frame` (描画コンテキスト), `app_state` (アプリケーションの現在の状態データ)
  - 戻り値: なし
- `save_tone(tone_data)`: 現在編集中のYM2151音色データを、指定されたファイル形式（例: JSON）でストレージに保存します。
  - 引数: `tone_data` (保存する音色データ)
  - 戻り値: 成功/失敗を示す結果
- `load_tone(file_path)`: アプリケーション起動時やユーザーの操作に応じて、ファイルからYM2151音色データを読み込み、アプリケーションの現在の音色状態として設定します。
  - 引数: `file_path` (読み込むファイルのパス)
  - 戻り値: 読み込まれた音色データ、またはエラー
- `send_audio_data(register_values)`: 編集中のYM2151レジスタの値をリアルタイムオーディオサーバーに送信し、即座に音声フィードバックを生成させます。
  - 引数: `register_values` (YM2151レジスタのデータ)
  - 戻り値: サーバー通信の成功/失敗を示す結果
- `preview_tone(note_number)`: 現在の音色設定で、特定のノートナンバー（音高）のサウンドを短時間再生し、音色のプレビューを提供します。
  - 引数: `note_number` (再生する音の高さ)
  - 戻り値: なし
- `increase_parameter_value(parameter_id, amount)`: 指定されたYM2151パラメータの値を特定の量(`amount`)だけ増加させます。
  - 引数: `parameter_id` (対象パラメータの識別子), `amount` (増加量)
  - 戻り値: なし
- `decrease_parameter_value(parameter_id, amount)`: 指定されたYM2151パラメータの値を特定の量(`amount`)だけ減少させます。
  - 引数: `parameter_id` (対象パラメータの識別子), `amount` (減少量)
  - 戻り値: なし

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした。

---
Generated at: 2025-11-28 07:08:25 JST
