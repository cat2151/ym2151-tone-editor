Last updated: 2025-11-11

# Development Status

## 現在のIssues
- [Issue #7](../issue-notes/7.md) および [Issue #4](../issue-notes/4.md) では、YM2151音色データのJSONエクスポート機能の実装を目指しており、`ym2151-log-play-server`フォーマットでの保存を検討しています。
- [Issue #5](../issue-notes/5.md) では、アプリケーション起動時に最新のJSONファイルを音色データとして読み込み、TUIに反映させる機能の仮仕様が提示されています。
- [Issue #2](../issue-notes/2.md) では、数値増減時に子プロセスで`cat-play-mml`を呼び出すことで、リアルタイムな音色確認の実現を計画しています。

## 次の一手候補
1. YM2151音色データのJSONエクスポート機能の完成 ([Issue #7](../issue-notes/7.md), [Issue #4](../issue-notes/4.md))
   - 最初の小さな一歩: `src/main.rs` 内で、現在のYM2151音色データをJSON形式にシリアライズし、指定されたフォーマットでファイルに保存する基本ロジックを実装する。
   - Agent実行プロンプト:
     ```
     対象ファイル: `src/main.rs`と`Cargo.toml`

     実行内容: `src/main.rs`内の既存のYM2151音色データを表現する構造体（例: Ym2151Event, Ym2151Logに相当するもの）に`serde::Serialize` deriveを追加してください。TUIアプリケーションの終了処理（例: ESCキー押下時）内で、現在の音色パラメータを`ym2151-log-play-server`互換のJSONフォーマットで、アプリケーションが起動したカレントディレクトリに`ym2151_tone_data_timestamp.json`のようなファイル名で保存する関数を追加し、その関数を呼び出すコードを組み込んでください。

     確認事項: `Cargo.toml`に`serde = { version = "1.0", features = ["derive"] }`と`serde_json = "1.0"`の依存関係が追加されていることを確認してください。また、生成されるJSONのスキーマが`ym2151-log-play-server`の期待する形式と一致しているか、およびファイル保存時のエラーハンドリングが適切に実装されていることを確認してください。

     期待する出力: `src/main.rs`の変更内容（特にシリアライズ対象の構造体とファイル保存ロジック）、および`Cargo.toml`の依存関係の変更点。
     ```

2. 起動時のJSONファイル読み込み機能の実装 ([Issue #5](../issue-notes/5.md))
   - 最初の小さな一歩: `src/main.rs` で起動時に、最新のYM2151音色データJSONファイルをカレントディレクトリから検索し、見つかった場合はその内容をYM2151音色データ構造にデシリアライズして初期状態に反映する。
   - Agent実行プロンプト:
     ```
     対象ファイル: `src/main.rs`と`Cargo.toml`

     実行内容: TUIアプリケーションの起動時（`main`関数の初期化フェーズ）に、カレントディレクトリ内で`ym2151_tone_data_*.json`のパターンに一致するファイルを検索し、更新日時が最も新しいものを特定してください。そのファイルを読み込み、内容をYM2151音色データ構造（例: Ym2151Log）にデシリアライズする処理を追加してください。デシリアライズが成功した場合、アプリケーションのYM2151音色パラメータをそのデータで初期化します。ファイルが見つからない、またはデシリアライズに失敗した場合は、エラーとせずデフォルトの音色設定でアプリケーションを起動するようにしてください。

     確認事項: `Cargo.toml`に`serde`と`serde_json`、およびファイルシステム操作のためのクレート（例: `walkdir`や`glob`など必要であれば）が適切に設定されていることを確認してください。また、デシリアライズするJSONのスキーマが、候補1で保存する形式と互換性があることを確認し、ファイル読み込みやデシリアライズに関するエラーハンドリングが適切であることを確認してください。

     期待する出力: `src/main.rs`の変更内容（特にファイル検索、読み込み、デシリアライズ、初期化ロジック）、および`Cargo.toml`の依存関係の変更点。
     ```

3. 数値増減時の`cat-play-mml`呼び出し機能の実装 ([Issue #2](../issue-notes/2.md))
   - 最初の小さな一歩: `src/main.rs` 内のYM2151パラメータの増減ロジックに、Rustの`std::process::Command`を用いて、固定のMML文字列を`cat-play-mml`にパイプして実行する子プロセス呼び出しを追加する。
   - Agent実行プロンプト:
     ```
     対象ファイル: `src/main.rs`

     実行内容: `src/main.rs`内のYM2151パラメータ（例: オペレータのAR, DRなど）を増減させるイベントハンドリングロジックに、`std::process::Command`を使用して`cat-play-mml`を子プロセスとして呼び出す処理を追加してください。現時点では、`cat-play-mml`に渡すMML文字列は、変更されたパラメータに基づいて生成される最小限のダミー文字列（例: `c4`）で構いません。このコマンド実行は非ブロッキングで行い、TUIのユーザーインターフェースがフリーズしないように考慮してください。

     確認事項: 子プロセス呼び出しがTUIのメインループをブロックしないことを確認してください（例: スレッドまたは非同期処理の利用）。`cat-play-mml`コマンドがシステムパスに存在しない場合や、コマンド実行に失敗した場合のエラーハンドリング（例: ログ出力のみでアプリケーションの続行）が適切に実装されていることを確認してください。

     期待する出力: `src/main.rs`の変更内容（特にパラメータ増減時の`Command::new`と`spawn`の利用箇所）。
     ```

---
Generated at: 2025-11-11 09:27:29 JST
