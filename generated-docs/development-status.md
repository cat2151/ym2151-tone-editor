Last updated: 2025-12-05

# Development Status

## 現在のIssues
- [Issue #137](../issue-notes/137.md)と[Issue #136](../issue-notes/136.md)は、PR #133で計画されたCTRL+Oバリエーション選択機能の第2段階として、カーソル移動時のオーディオプレビュー実装に焦点を当てています。
- この実装では、既存の`skim`セレクタをカスタムの`ratatui`ベースのセレクタに置き換え、カーソル移動時に選択中のトーンバリエーションを自動でプレビューする機能を追加します。
- 現在はカスタムセレクタによるオーディオプレビュー機能の統合、テスト、および旧`skim`関連コードのクリーンアップが主要なタスクです。

## 次の一手候補
1. [Issue #137](../issue-notes/137.md) カスタム`ratatui`セレクタでのオーディオプレビュー機能の実装を完了する
   - 最初の小さな一歩: `src/variation_selector.rs` 内で、カスタム`ratatui`セレクタのカーソル移動イベントを捕捉し、選択されたバリエーションのトーンデータを取得するロジックを実装します。その後、`src/audio.rs`のプレビュー機能と連携させるためのインターフェースを検討します。
   - Agent実行プロンプ:
     ```
     対象ファイル: src/app.rs, src/variation_selector.rs, src/audio.rs

     実行内容: `src/variation_selector.rs`内のカスタム`ratatui`セレクタにおいて、カーソル移動時に現在選択されているトーンのバリエーションデータを検出し、そのデータを`src/audio.rs`が提供するオーディオプレビュー機能に渡すための接着コードを実装する。これにより、カーソル移動時の自動オーディオプレビューを実現する。

     確認事項: 既存のオーディオ再生ロジック（`src/audio.rs`）との連携が適切に行われること。UIのイベントループ（`src/app.rs`）内でプレビュー処理がブロックされないこと。`skim`関連のコードが完全にカスタムセレクタに置き換えられていることを前提とする。

     期待する出力: `src/variation_selector.rs`および`src/app.rs`に対するコード変更（`audio.rs`への呼び出し追加、カーソル移動イベント処理の追加など）。変更箇所の説明をMarkdown形式で出力。
     ```

2. [Issue #137](../issue-notes/137.md) カスタム`ratatui`セレクタでのオーディオプレビュー機能に対するテストを追加する
   - 最初の小さな一歩: `src/tests/variation_selector_tests.rs` に、バリエーションセレクタがカーソル移動時に特定のトーンデータをオーディオモジュールに渡すことをシミュレートするテストケースのスケルトンを作成します。必要に応じてモックオブジェクトの利用を検討します。
   - Agent実行プロンプト:
     ```
     対象ファイル: src/tests/variation_selector_tests.rs, src/variation_selector.rs, src/audio.rs

     実行内容: `src/tests/variation_selector_tests.rs`に、カスタム`ratatui`セレクタのカーソル移動によるオーディオプレビュー機能の単体テストを追加する。具体的には、バリエーションセレクタ内でカーソルが移動した際に、`src/audio.rs`の適切なプレビュー関数が正しいトーンデータで呼び出されることを検証するテストケースを記述する。必要であれば、`src/audio.rs`をモック化して検証する。

     確認事項: テストが独立しており、外部の状態に依存しないこと。オーディオ再生の実装（候補1）が完了していることを前提とする。`ratatui`セレクタの内部状態（カーソル位置、選択中のバリエーション）を適切にシミュレートできること。

     期待する出力: `src/tests/variation_selector_tests.rs`に対するテストコードの追加。テストの目的と検証内容をMarkdown形式で出力。
     ```

3. `skim`関連のコードをプロジェクトから完全にクリーンアップし削除する
   - 最初の小さな一歩: プロジェクト全体から`skim`クレートへの依存を`Cargo.toml`から削除し、関連する`use`文や構造体、関数呼び出しを特定してコメントアウトします。
   - Agent実行プロンプト:
     ```
     対象ファイル: Cargo.toml, src/app.rs, src/variation_selector.rs, およびプロジェクト内の`skim`に関連する可能性のある全てのファイル

     実行内容: `skim`ライブラリへの依存関係および、それに関連する全てのコードをプロジェクトから削除する。これには`Cargo.toml`からの依存関係の除去、`src/app.rs`や`src/variation_selector.rs`などでの`skim`のimport文、`skim`の関数呼び出し、`skim`に関連するデータ構造の定義などが含まれる。

     確認事項: `skim`が完全にカスタム`ratatui`セレクタに置き換えられていること（[Issue #137](../issue-notes/137.md)のフェーズ1が完了していること）。コードベースの他の部分に影響を与えないこと。コンパイルエラーが発生しないこと。

     期待する出力: `skim`関連のコードが削除された`Cargo.toml`および関連ソースファイル。削除されたファイルのリストと、変更の概要をMarkdown形式で出力。

---
Generated at: 2025-12-05 07:07:35 JST
