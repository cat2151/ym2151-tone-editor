# issue PR 137 を取り込んでWindows版をビルドしたところ、ビルドエラーで落ちた #139
[issues #139](https://github.com/cat2151/ym2151-tone-editor/issues/139)

# 事象：
- fzf風の音色list選択機能をagentに実装させたところ、Windows版でビルドエラー。

# 原因分析：
- PR 137 のagentのふるまいについて、
  - 選定したライブラリが、古い。
  - Windows考慮漏れ。
  - 全体にハルシネーションの度合いが高い、と判断する。

# 対策：
- 外部LLMにビルドエラーのログを読ませて、対策案を生成させた。

# ゴール：
- 以下に書いてあるものが実装されること。

---

# ✅ **Issue: Windows 対応の fzf-like UI + カーソル移動でプレビュー音を鳴らす実装**

## 🎯 目的

Windows アプリとして、下記を満たす fzf ライク UI コンポーネントを実装してください：

1. **リアルタイム絞り込み（fuzzy search）**
2. **上下カーソル移動のたびにプレビュー音を鳴らす **
3. **Windows で確実に動作する UI（Crossterm または ratatui ベース）**
4. **fzf のように候補が縦に並び、現在位置がハイライトされる**
5. **検索結果が即時更新される（インクリメンタルサーチ）**

---

## 🟥 禁止事項（重要）

以下のライブラリは **使わないでください**：

* `skim`（UI 全体）

  * Windows 非対応の旧バージョンが選ばれてしまうため
  * 音・イベント制御ができないため
* `tuikit`

  * Windows ではビルド不能
* `nix` 系 API

---

## 🟩 必須要件

### **UI フレームワーク**

以下のいずれか：

* **Crossterm**
* **ratatui（旧 tui-rs）**

理由：キーイベントを完全に捕捉でき、Windows 対応が安定しているため。

---

### **検索（fuzzy matching）**

UI と切り分け、検索部分は独立したコンポーネントとして実装し、
以下いずれかのライブラリを使用：

* `skim-core`（検索アルゴリズムのみを使う）
* `fuzzy-matcher`（もしくは `fuzzy-matchers`）

fzf のように **インクリメンタルで毎キー入力ごとに再フィルタ**。

---

### **動作要件**

* 入力テキストボックス
* 候補リスト
* 上下キーでカーソル移動（プレビュー音を鳴らす）
* Enter で確定

---

## 🟦 実装構成例（必須ではないが推奨）

```
src/
 ├─ list_ui/
 │   ├─ input.rs        ← Crossterm で入力管理
 │   ├─ listview.rs     ← 候補表示、ハイライト、カーソル移動でプレビュー音
 │   └─ layout.rs       ← レイアウト
 ├─ search/
 │   ├─ engine.rs       ← skim-core / fuzzy-matcher を使った検索
 │   └─ score.rs
 └─ main.rs
```

---

## 🎨 UI の参考イメージ

```
Query: GM0
---------------------------------
> GM000 Piano
  GM099 
---------------------------------
```

---

# 🟩 最終的な成果物

* Windows でビルド成功すること
* キーイベントすべて捕捉
* カーソル移動でプレビュー音
* fzf ライクの UI
* リアルタイムフィルタリング

---

# 🔧 補足

LIST UI 部分と fuzzy search 部分は分離し、モジュール化してください。
将来的に検索アルゴリズムを差し替え可能にしたいためです。

---

